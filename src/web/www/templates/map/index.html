<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>好空气网</title>
    <link href="/static/www/css/common.css" rel="stylesheet" type="text/css" />
    <link href="/static/www/css/union.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="/static/www/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/static/www/js/jquery.DB_tabMotionBanner.min.js"></script>
    <script type="text/javascript" src="/static/www/js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="/static/www/js/main.js"></script>
    <script type="text/javascript" src="/static/www/js/laydate/laydate.js"></script>
    <link rel="stylesheet" href="https://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=90njCvBxUel6rnaBDtsArATHSrtvj5j4"></script>
    <script type="text/javascript" src="https://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
</head>

<body style="overflow:scroll;overflow-x:hidden">

{% include "header.html" %}

<!------banner--------->
<div id="banner" class="yd-banner">
    <div class="bg">
        <span><img src="/static/www/images/yd-banner006.png" /></span>
    </div>

    <div id="ly-con4">
        <ul class="inf">
            <a href="javascript:void(0)"><li class="d6">全国地图<span></span></li></a>
        </ul>

        <div class="right">

            <div class="cen4" id="ly-conbg">
                <h1>污染地图</h1>
                <p class="hp">DATA MAP</p>

                <div class="tj-select">
                    <div class="tj-sanji">
                        <a id="search_date_start" href="javascript:void(0);" class="s-date" onclick="laydate({istime:false, format: 'YYYY-MM-DD'})">
                            {{ date_start }}
                        </a>
                        <hr />
                        <a id="search_date_end" href="javascript:void(0);" class="e-date" onclick="laydate({istime:false, format: 'YYYY-MM-DD'})">
                            {{ date_end }}
                        </a>
                        <a href="javascript:void(0);" class="tj-btn2" onclick="history_search()">查询</a>
                        <a href="/data/history" class="tj-btn3">重置</a>
                    </div>
                </div>

                <div class="w800 mt20">
                    <div id="baidu_map" style="width: 100%;height: 700px;"></div>
                </div>

            </div>
        </div>
    </div>

</div>
<!------banner--------->

{% include "footer.html" %}

<script type="text/javascript">
	// 百度地图API功能
	var map = new BMap.Map("baidu_map");  // 创建Map实例
	map.centerAndZoom("{{ city_name }}", 8);      // 初始化地图,用城市名设置地图中心点
	map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
    map.addControl(new BMap.NavigationControl());
    map.addControl(new BMap.ScaleControl());
    map.addControl(new BMap.OverviewMapControl());
    map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
    map.enableScrollWheelZoom(true);             //开启鼠标滚轮缩放

	function geocodeSearch(add, text){
		myGeo.getPoint(add, function(point){
			if (point) {
                //console.info(index + "、" + add + ":" + point.lng + "," + point.lat);
				var address = new BMap.Point(point.lng, point.lat);
				//addMarker(address,new BMap.Label(index+":"+add,{offset:new BMap.Size(20,-10)}));

                var opts_tip = {
                    position : address,
                    offset   : new BMap.Size(20, -10)
                };
                var label_tip = new BMap.Label(text, opts_tip);  // 创建文本标注对象
                label_tip.setStyle({
                    color : "black",
                    background: 'rgba(255,255,255,0.8)',
                    fontSize : "12px",
                    border:'1px solid #999',
                    width: "auto",
                    textAlign:"center",
                    height : "18px",
                    lineHeight : "18px"
                });
                map.addOverlay(label_tip);
			}
		}, "{{ city_name }}");
	}

    var myGeo = new BMap.Geocoder();
    {% for city in city_all %}
        geocodeSearch("{{ city['city_name'] }}", "{{ city['city_name'] }}");
    {% endfor %}
    map.centerAndZoom("{{ city_name }}", 8);
</script>


</body>
</html>
